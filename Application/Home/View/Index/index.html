 <!DOCTYPE html>
 <html lang="zh-cmn-Hans">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>AirFight</title>
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
</head>
<body>
    <div id="map">
        
    </div>
    <div>
        已添加飞机<b id="planeCnt">0</b>架,还需添加<b id="planeLast"></b>架
    </div>
    <form role="form">
        <div class="form-group">
            <label for="name">X</label>
            <select class="form-control" id="corY">
                <option value="1">A</option>
                <option value="2">B</option>
                <option value="3">C</option>
                <option value="4">D</option>
                <option value="5">E</option>
                <option value="6">F</option>
                <option value="7">G</option>
                <option value="8">H</option>
                <option value="9">I</option>
            </select>
        </div>
        <div class="form-group">
            <label for="name">Y</label>
            <select class="form-control" id="corX">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
                <option>5</option>
                <option>6</option>
                <option>7</option>
                <option>8</option>
                <option>9</option>
            </select>
        </div>
        <div class="form-group">
            <label for="name">方向</label>
            <select class="form-control" id="corD">
                <option value="1">↑</option>
                <option value="2">↓</option>
                <option value="3">←</option>
                <option value="4">→</option>
            </select>
        </div>
        <input id="btnAdd" class="btn btn-success" type="button" name="test" value="添加">
        <input id="btnSub" class="btn btn-success" type="button" name="test" value="开战">
        <input id="btnClr" class="btn btn-success" type="button" name="test" value="清空">
    </form>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="subModal" tabindex="-1" role="dialog" aria-labelledby="subModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                    data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="subModalLabel">
                    选择建房/加入房间
                    </h4>
                </div>
                <div class="modal-body">
                    <div id="chooseHoC">
                        <input id="btnHost" class="btn btn-success" type="button" name="test" value="建房">
                        <input id="btnChallenger" class="btn btn-success" type="button" name="test" value="加入房间">
                    </div>
                </div>
                
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div><!-- /.modal -->

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="roomModal" tabindex="-1" role="dialog" aria-labelledby="roomModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close"
                    data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="roomModalLabel">
                    请输入房间号码
                    </h4>
                </div>
                <div class="modal-body">
                    <div id="chooseHoC">
                        <div class="form-group">
                            <label for="roomId">输入房间号码</label>
                            <input type="text" class="form-control" id="roomId" 
                                placeholder="输入房间号码">
                        </div>
                        <input id="btnRoomJoin" class="btn btn-success" type="button" name="test" value="加入房间">
                    </div>
                </div>
                
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div><!-- /.modal -->
</body>
<script type="text/javascript">
    var mapLen = 9;
    var mapWid = 9;
    var planeNum = 3;
    $("#planeLast").html(planeNum);
    var planeCnt = 0;
    var planeMap = new Array();
    for (var i = 0; i < mapLen; i++) {
        planeMap[i] = new Array();
        for (var j = 0; j < mapWid; j++) {
            planeMap[i].push(0);
        }
    }
    

    var planeType = new Array();
    planeType[1] = [
    [0, 0, 5, 0, 0],
    [1, 1, 1, 1, 1],
    [0, 0, 1, 0, 0],
    [0, 1, 1, 1, 0],
    [0, 0, 0, 0, 0]
    ]
    planeType[2] = [
    [0, 1, 1, 1, 0],
    [0, 0, 1, 0, 0],
    [1, 1, 1, 1, 1],
    [0, 0, 5, 0, 0],
    [0, 0, 0, 0, 0]
    ]
    planeType[3] = [
    [0, 1, 0, 0, 0],
    [0, 1, 0, 1, 0],
    [5, 1, 1, 1, 0],
    [0, 1, 0, 1, 0],
    [0, 1, 0, 0, 0]
    ]
    planeType[4] = [
    [0, 0, 1, 0, 0],
    [1, 0, 1, 0, 0],
    [1, 1, 1, 5, 0],
    [1, 0, 1, 0, 0],
    [0, 0, 1, 0, 0]
    ]

    //添加飞机触发函数
    $("#btnAdd").click(function() {
        var corX = $("#corX").val();
        var corY = $("#corY").val();
        var corD = $("#corD").val() - 0;
        var res =  convertXY(corD,corX,corY);

        addPlaneToMap(corD,res[0],res[1])
        //console.log(res);
    });

    //提交布局
    $("#btnSub").click(function() {
        /*
        if (planeCnt != planeNum) {
            alert("请添加足够的飞机！");
            //return;
        }
        
        $.ajax({
            url: '__CONTROLLER__/addPlane',
            type: 'POST',
            data: {
                mapLen: mapLen,
                mapWid: mapWid,
                planeMap: planeMap
            },
            success:function(result,status,xhr) {
                console.log(result)
            }
        })
        .done(function() {
            console.log("success");
        })
        .fail(function() {
            console.log("error");
        })
        .always(function() {
            console.log("complete");
        });

        */
        $("#subModal").modal("show");
    });

    //建房

    //加入房间
    $("#btnChallenger").click(function() {
        $("#subModal").modal("hide");
        $("#roomModal").modal("show");
    });

    //清空布局
    $("#btnClr").click(function() {
        for (var i = 0; i < mapLen; i++) {
            for (var j = 0; j < mapWid; j++) {
                planeMap[i][j] = 0;
            }
        }
        planeCnt = 0;
        $("#btnAdd").attr({
            value: '添加'
        }).removeAttr('disabled');
        showMap();
    });

    //转换机头坐标到planeType零点坐标
    function convertXY(corD,corX,corY) {
        var resX,resY;
        switch(corD) {
            case 1:
            resX = corX - 2;
            resY = corY - 0;
            break;
            case 2:
            resX = corX - 2;
            resY = corY - 3;
            break;
            case 3:
            resX = corX - 0;
            resY = corY - 2;
            break;
            case 4:
            resX = corX - 3;
            resY = corY - 2;
            break;
            default:
            alert("ERROR!")
        }
        var res = new Array(resX,resY);
        return res;
    }

    //添加飞机到自己的地图
    function addPlaneToMap(corD,resX,resY) {
        if (planeCnt == 3) {
            alert("已经添加三架飞机了！");
            return false;
        }
        var planeMapTem = new Array();
        for (var i = 0; i < mapLen; i++) {
            planeMapTem[i] = new Array();
            for (var j = 0; j < mapWid; j++) {
                planeMapTem[i][j] = planeMap[i][j];
            }
        }
        console.log(1);
        console.log(planeMapTem);
        for (var i = 0; i < 5; i++) {
            for (var j = 0; j < 5; j++) {
                var dot = planeType[corD][i][j];
                if (!dot) {
                    continue;
                }
                if (resY - 1 + i < 0 || resY - 1 + i >= mapLen || resX - 1 + j < 0 || resX - 1 + j >= mapWid) {
                    alert("飞机超出边界！请检查");
                    return;
                }
                if (planeMapTem[resY - 1 + i][resX - 1 + j] == 0) {
                    planeMapTem[resY - 1 + i][resX - 1 + j] = planeCnt + dot;
                    continue;
                }
                else{
                    alert("添加飞机错误！请检查");
                    return;
                }
            }
        }
        console.log(1);
        planeCnt++;
        if (planeCnt == planeNum) {
            $("#btnAdd").attr({
                disabled: 'disabled',
                value: '完成'
            });
        }
        planeMap = planeMapTem;
        showMap();
    }

    
    //显示地图
    var chaList = new Array("A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N");
    showMap();
    function showMap() {
        $("#map").html("");
        for (var i = 0; i <= mapWid; i++) {
            $("#map").append(i+"&nbsp;");
        }
        $("#map").append("<br>");
        for (var i = 0; i < mapLen; i++) {
            $("#map").append(chaList[i]+"&nbsp;");
            for (var j = 0; j < mapWid; j++) {
                $("#map").append(planeMap[i][j]+"&nbsp;");
            }
            $("#map").append("<br>");
        }
        $("#planeCnt").html(planeCnt);
        $("#planeLast").html(planeNum - planeCnt);
    }
</script>
</html>
